/*! ajaxnoir 2018-04-24 */

function Login(a){console.log("Login constructed");var t=$(a);t.submit(function(e){e.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(e){var t=parse_json(e);console.log(t),t.ok?window.location.assign("./"):$(a+" .message").html("<p>"+t.message+"</p>")},error:function(e,t,o){console.log(o),$(a+" .message").html("<p>Error: "+o+"</p>")}})})}function MovieInfo(o,e,t){console.log("MovieInfo: "+e+"/"+t);var a=this;$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"a5ce7b8695030eee28fb599aba8b1eeb",query:e,year:t},method:"GET",dataType:"text",success:function(e){var t=parse_json(e);0==t.total_results?$(".paper").html("<p>No information available</p>"):a.printResult(o,t.results[0]),console.log(t)},error:function(e,t,o){console.log(o),$(".paper").html("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(t){try{var e=$.parseJSON(t)}catch(e){throw"JSON parse error: "+t}return e}function Stars(e){console.log("Stars constructor");for(var t=$(e+" table").find("tr"),o=1;o<t.length;o++)for(var a=$(t.get(o)),r=a.find('input[name="id"]').val(),s=a.find("img"),n=0;n<s.length;n++){var i=$(s.get(n));this.installListener(a,i,r,n+1)}}MovieInfo.prototype.printResult=function(e,t){var o="<ul>";o+='<li id = \'info\'><a href=""><img src="images/info.png"></a>',o+="<div>",o+="<p>Title: "+t.title+"</p>",o+="<p>Release Date: "+t.release_date+"</p>",o+="<p>Vote Average: "+t.vote_average+"</p>",o+="<p>Vote Count: "+t.vote_count+"</p>",o+="</div></li>",o+='<li id = \'plot\'><a href=""><img src="images/plot.png"></a>',o+="<div>",o+="<p>"+t.overview+"</p>",o+="</div></li>",o+="<li id='poster'><a href='#'><img src='images/poster.png'></a>",o+="<div>",o+="<p class='poster'><img src='http://image.tmdb.org/t/p/w500/"+t.poster_path+"'></p>",o+="</div></li>",o+="</ul>",$(e).html(o)},Stars.prototype.installListener=function(o,e,t,a){var r=this;e.click(function(){console.log("Click on "+t+" rating: "+a),$.ajax({url:"post/stars.php",data:{id:t,rating:a},method:"POST",success:function(e){var t=parse_json(e);t.ok?(r.update(o,a),r.updateTable(t.table),r.message("<p>Successfully updated</p>"),new Stars("form")):r.message("<p>Update failed</p>")},error:function(e,t,o){r.message("<p>Error: "+o+"</p>")}})})},Stars.prototype.update=function(e,t){for(var o=e.find("img"),a=0;a<o.length;a++){var r=$(o.get(a));a<t?r.attr("src","images/star-green.png"):r.attr("src","images/star-gray.png")}e.find("span.num").text(t+"/10")},Stars.prototype.message=function(e){$(".message").html(e).show().delay(2e3).fadeOut(1e3)},Stars.prototype.updateTable=function(e){$("table").html(e)};